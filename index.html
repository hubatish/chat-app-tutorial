<!doctype html>  
<html lang="en">  
    <head>
      <script src="/jquery/dist/jquery.js"></script>
      <script src="/socket.io/socket.io.js"></script>
      <!-- Client Socket Emit -->
      <script>
        // Handles both localhost and AWS.
        var serverIp = window.location.href;
        var socket = io.connect(serverIp);

        let id = '';
        let gameStarted = false;

        const Role = {
          Werewolf: 'Werewolf',
          Villager: 'Villager',
          Seer: 'Seer'
        };

        $(function() {
          // document ready.

          // Set up name changing.
          $('#name_form').submit(function(e){
            e.preventDefault();
            var name = $('#name_input').val();
            socket.emit('nameSet', {name});
            $("#name_form").hide();
            $("#name_change_btn").text("Change name from " + name);
            $("#name_change_btn").show();
            if (!gameStarted) {
              $("#start_game_root").show();
            }
          });
          $("#name_change_btn").click(() => {
            $("#name_form").show();
            $("#name_change_btn").hide();
          });

          $('#start_game_btn').click(() => {
            socket.emit('startGame', {});
            $('#start_game_root').hide();
          });
        });

        socket.on('connect', function(data) {
          socket.emit('join', {});
        });

        socket.on('clientJoin', function(data) {
          id = data.id;
          // durrr don't really need id...
          // got back id - show the starting screen & hide loading.
          $("#name_change_root").show();
          $("#loading").hide();
          $("#player_list_root").show();
        });

        socket.on('allPlayersNames', (names) => {
          console.log(names);
          $("#player_list").empty();
          for (const name of names) {
            $("#player_list").append("<p>"+name+"</p>");
          }
        });

        socket.on('startGame', (data) => {
          console.log('game started msg received' + data.role);
          gameStarted = true;
          $('#start_game_root').hide();
          $('#ability_root').show();
          $('#role_text').text('Role: ' + data.role);
        });
       </script>
    </head>
    <body>
      <h1>Play Werewolf!</h1>
      <div hidden id="name_change_root">
        <form id="name_form">
          <input id="name_input" type="text">
          <input type="submit" value="Set Name">
        </form>
        <button hidden id="name_change_btn">Change your name.</button>
      </div>
      <div hidden id="start_game_root">
        <p>After five minutes, vote to kill someone. The werewolves and minion win if a werewolf is not killed.</p>
        <button id="start_game_btn">Start Round</button>
        <p>^ Press only when everyone is ready.</p>
      </div>
      <p id="loading">Loading..</p>
      <div hidden id="ability_root">
        <p id="role_text">Role: </p>
      </div>
      <div hidden id="player_list_root">
          <p>Players</p>
          <ul id="player_list"></ul>
        </div>
      </body>
</html>  
